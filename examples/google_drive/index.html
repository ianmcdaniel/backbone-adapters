<!doctype html>
<html>
	<head>
		<title>Test Page</title>
		<style>
			html,
			body{width:100%;height:100%;}

			

.bd,.ft, .hd{overflow:hidden; *overflow:visible; zoom:1;text-overflow:ellipsis}
			
.media{overflow:hidden;*overflow:visible;zoom:1;}
.media .img{float:left;margin-right: 10px;}
.media .img img{display:block;}
.media .imgExt{float:right; margin-left: 10px;}
			
		</style>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	</head>
	<body>
	
	
	<h4>Google Drive API</h4>
	
	<button id="google_btn">Login with Google</button>
	<ul id="file_list"></ul>
	

  <script>
    function googleDriveOauth() {
      var 
        url           = "https://accounts.google.com/o/oauth2/auth",
        scope         = [
          "https://www.googleapis.com/auth/userinfo.email",
          "https://www.googleapis.com/auth/userinfo.profile",
          "https://docs.google.com/feeds/",
          "https://docs.googleusercontent.com/"
        ],
        state         = "profile",
        redirect_uri  = "http://localhost:8888/oauth2callback",
        response_type = "token",
        client_id     = "177207392140.apps.googleusercontent.com"
    
      return url + "?" + [
        "scope=" + scope.join('+'),
        "state=" + state,
        "redirect_uri=" + redirect_uri,
        "response_type=" +response_type,
        "client_id=" + client_id,
        "approval_prompt=force"
      ].join('&')

    }
    
    // doc list
    //https://docs.google.com/feeds/documents/private/full
    //callback=mycallback&alt=json
    
    
    // user info
    // https://www.googleapis.com/oauth2/v1/userinfo
    
    $('#google_btn').on('click',function(){
      window.location.href = googleDriveOauth();
    })
  
    var 
      params = {}, 
      queryString = location.hash.substring(1),
      regex = /([^&=]+)=([^&]*)/g, 
      m;
      
    while (m = regex.exec(queryString)) {
      params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
    }
    
    console.info(params)
  
    if(params.access_token) {
      $('#google_btn').hide()
      $.ajax('https://docs.google.com/feeds/documents/private/full',{
        data:{
          access_token: params.access_token,
          alt:'json'
        },
        dataType:'jsonp',
        success:function(data) {
          if(data.feed && data.feed.entry) {
            populate(data.feed.entry);
          }
          console.log(data)
        }
      })
    
    
    }
    
    function populate(files) {
      var ul = $('#file_list');
      $(files).each(function(i, file) {
        ul.append("<li>"+file.title.$t+" <a href='"+file.content.src+"'>Download</a></li>")
      
      });
    
    }
  
  
  </script>


  


	</body>
</html>